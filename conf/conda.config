/*
 * Centralized Conda Environment Configuration
 *
 * This file defines all conda environments used across the pipeline.
 * Environments are grouped by tool/purpose for easier maintenance.
 */

process {
    // ==========================================================================
    // PYTHON BASE ENVIRONMENTS
    // ==========================================================================
    // Simple Python 3.9 for lightweight scripts
    withName: 'COUNT_REGIONS|TABULATE_REGIONS|AGGREGATE_TAXONOMY|CREATE_NAME_MAP|RENAME_GENOMES|COLLECT_VERSIONS' {
        conda = "conda-forge::python=3.9"
    }

    // Python with SQLite for database operations
    withName: 'EXTRACT_CLUSTERING_STATS' {
        conda = "conda-forge::sqlite conda-forge::python=3.9"
    }

    // Python with pandas for data processing
    withName: 'EXTRACT_GCF_REPRESENTATIVES' {
        conda = "conda-forge::python=3.9 conda-forge::pandas"
    }

    // ==========================================================================
    // BIOINFORMATICS TOOLS
    // ==========================================================================
    // antiSMASH for BGC detection
    withName: 'GET_ANTISMASH_VERSION|ANTISMASH|DOWNLOAD_ANTISMASH_DBS' {
        conda = "bioconda::antismash"
    }

    // BiG-SCAPE for GCF clustering (pinned pyhmmer for compatibility)
    withName: 'BIGSCAPE' {
        conda = "bioconda::bigscape 'bioconda::pyhmmer<0.11'"
    }

    // BiG-SLiCE for alternative clustering
    withName: 'BIGSLICE|DOWNLOAD_BIGSLICE_MODELS' {
        conda = "bioconda::bigslice conda-forge::python=3.9 conda-forge::sqlite"
    }

    // GTDB-Tk for phylogenetic classification
    withName: 'GTDBTK_CLASSIFY' {
        conda = "python=3.10 bioconda::gtdbtk=2.6.1"
    }

    // GTDB-Tk database download (with aria2 for parallel downloads)
    withName: 'DOWNLOAD_GTDBTK_DB' {
        conda = "python=3.10 conda-forge::aria2 bioconda::gtdbtk=2.6.1"
    }

    // Taxonomy processing
    withName: 'EXTRACT_TAXONOMY' {
        conda = "bioconda::taxonkit conda-forge::biopython"
    }

    withName: 'DOWNLOAD_TAXONKIT_DB' {
        conda = "bioconda::taxonkit conda-forge::wget"
    }

    // ==========================================================================
    // SEQUENCE PROCESSING
    // ==========================================================================
    // BioPython for GenBank/FASTA operations
    withName: 'GENBANK_TO_FASTA' {
        conda = "conda-forge::biopython"
    }

    // GTDB-Tk result filtering (requires pandas + biopython)
    withName: 'FILTER_GTDBTK_RESULTS' {
        conda = "conda-forge::python=3.9 conda-forge::pandas conda-forge::biopython"
    }

    // ==========================================================================
    // DATABASE DOWNLOADS
    // ==========================================================================
    // NCBI datasets CLI
    withName: 'NCBI_DATASETS_DOWNLOAD' {
        conda = "conda-forge::ncbi-datasets-cli conda-forge::unzip"
    }

    // Pfam database (HMMER)
    withName: 'DOWNLOAD_PFAM' {
        conda = "bioconda::hmmer conda-forge::wget"
    }

    // ==========================================================================
    // VISUALIZATION
    // ==========================================================================
    // Full visualization environment
    withName: 'VISUALIZE_RESULTS' {
        conda = "conda-forge::python=3.9 conda-forge::pandas conda-forge::matplotlib conda-forge::seaborn conda-forge::numpy conda-forge::biopython"
    }
}
