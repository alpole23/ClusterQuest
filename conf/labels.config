/*
 * Process Labels Configuration
 *
 * Defines resource allocations and error handling for labeled processes.
 * Labels provide a clean separation between process logic and resource requirements.
 */

process {
    // ==========================================================================
    // RESOURCE LABELS
    // ==========================================================================

    // Local execution (no resources needed, runs on head node)
    withLabel: 'process_local' {
        executor = 'local'
        cpus = 1
        memory = '1 GB'
    }

    // Low resource processes (Python scripts, simple operations)
    withLabel: 'process_low' {
        cpus = 1
        memory = '2 GB'
        time = '1h'
    }

    // Medium resource processes (antiSMASH, data processing)
    withLabel: 'process_medium' {
        cpus = 4
        memory = '8 GB'
        time = '2h'
    }

    // High resource processes (BiG-SCAPE, BiG-SLiCE clustering)
    withLabel: 'process_high' {
        cpus = 8
        memory = '32 GB'
        time = '8h'
    }

    // High memory processes (GTDB-Tk pplacer)
    // Default to 48 GB for local/workstation - SLURM profile overrides to 128 GB
    withLabel: 'process_high_memory' {
        cpus = 8
        memory = '48 GB'
        time = '24h'
    }

    // ==========================================================================
    // ERROR HANDLING LABELS
    // ==========================================================================

    // Tolerant processes - individual failures don't stop the pipeline
    // Used for per-genome processes where some failures are expected
    withLabel: 'tolerant' {
        errorStrategy = 'ignore'
    }

    // Retry on transient errors (network issues, temporary failures)
    withLabel: 'retry_on_error' {
        errorStrategy = { task.exitStatus in [1, 143, 137, 104, 134, 139] ? 'retry' : 'finish' }
        maxRetries = 3
    }
}
